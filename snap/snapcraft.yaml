name: battery-notifier
version: '0.1.0'
summary: Battery Notifier
description: |
  An app that notifies you when a device battery reaches 20 or 80 percent.
base: core22
confinement: strict
grade: devel
compression: lzo

apps:
  battery-notifier:
    command: electron/battery-notifier --no-sandbox
    extensions: [gnome]
    plugs:
      - browser-support
      - network
      - network-bind
      - upower-observe
    environment:
      # Correct the TMPDIR path for Chromium Framework/Electron to ensure
      # libappindicator has readable resources.
      TMPDIR: $XDG_RUNTIME_DIR

parts:
  battery-notifier:
    plugin: dump
    source: .
    override-build: |
      mkdir -p source
      find . -maxdepth 1 -mindepth 1 ! -name 'new_dir' -exec mv {} source/ \;
      npx @electron/packager ./source/release/app battery-notifier --overwrite --platform=linux --prune=true --out=$SNAPCRAFT_PART_INSTALL/
      mv $SNAPCRAFT_PART_INSTALL/battery-notifier-linux-* $SNAPCRAFT_PART_INSTALL/electron
      mkdir $SNAPCRAFT_PART_INSTALL/electron/resources/assets
      cp source/assets/*.* $SNAPCRAFT_PART_INSTALL/electron/resources/assets
      rm -rf source

      snapcraftctl build

      chmod -R 755 $SNAPCRAFT_PART_INSTALL
    build-snaps:
      - node/18/stable

  upower:
    plugin: nil
    stage-packages: [ upower ]
